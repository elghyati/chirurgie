{% extends 'base.html.twig' %}

{% block title %}Produits{% endblock %}

{% block body %}
    <!-- Start All Title Box -->
    {#    <div class="all-title-box"> #}
    {#        <div class="container"> #}
    {#            <div class="row"> #}
    {#                <div class="col-lg-12"> #}
    {#                    <h2>Produits</h2> #}
    {#                    <ul class="breadcrumb"> #}
    {#                        <li class="breadcrumb-item"><a href="#">Home</a></li> #}
    {#                        <li class="breadcrumb-item active">Shop</li> #}
    {#                    </ul> #}
    {#                </div> #}
    {#            </div> #}
    {#        </div> #}
    {#    </div> #}
    <!-- End All Title Box -->

    <!-- Start Shop Page  -->
    <div class="box-inner">
        <div class="container-fluid" style="padding-right: 5%;padding-left: 5%;">
            <div>
                {% for header in headerimg %}
                    <img src="{{ asset('uploads/images/header/' ~ header.image) }}" style="width:100%;height: 285px;">
                {% else %}
                    <h3 class="next">Aucune image n'est enregistrée</h3>
                {% endfor %}
            </div>
            <br>
            <div class="row">
                <div class="col-xl-3 col-lg-3 col-sm-12 col-xs-12 sidebar-shop-left">
                    <div class="product-categorie">
                        <div class="filter-sidebar-left">
                            <div class="title-left">
                                <h3>Produits</h3>
                            </div>
                            <div class="list-group list-group-collapse list-group-sm list-group-tree"
                                 id="list-group-men" data-children=".sub-men">
                                {% for famille in familles %}
                                <div class="list-group-collapse sub-men">
                                    <a class="categ-li list-group-item list-group-item-action collapse-btn"
                                       href="#sub-men{{ famille.id }}" data-toggle="collapse" aria-expanded="false"
                                       aria-controls="sub-men{{ famille.id }}">{{ famille.famille }}<small
                                                class="text-muted">({{ famille.sousFamilles| length }})</small>
                                    </a>
                                    {% if famille is same as(sousFamille.famille) %}
                                    <div class="collapse show collapse-content" id="sub-men{{ famille.id }}"
                                         data-parent="#list-group-men">
                                        {% else %}
                                        <div class="collapse" id="sub-men{{ famille.id }}"
                                             data-parent="#list-group-men">
                                            {% endif %}
                                            <div class="list-group">
                                                {% for sFamille in  famille.sousFamilles %}
                                                    {% if sFamille is same as(sousFamille) %}
                                                        <a href="{{ path('article_sub_shop', {id: sFamille.id}) }}"
                                                           class="categ-list list-group-item list-group-item-action active">{{ sFamille }}
                                                            <small class="text-muted">({{ sFamille.articles | length }}
                                                                )</small></a>
                                                    {% else %}
                                                        <a href="{{ path('article_sub_shop', {id: sFamille.id}) }}"
                                                           class="categ-list list-group-item list-group-item-action">{{ sFamille }}
                                                            <small class="text-muted">({{ sFamille.articles | length }}
                                                                )</small></a>
                                                    {% endif %}
                                                    {# <a href="{{ path('article_sub_shop', {id: sFamille.id}) }}" class="list-group-item list-group-item-action">ThermomÃ¨tre <small class="text-muted">(2)</small></a> #}
                                                {% endfor %}
                                            </div>
                                            {#                                            </div> #}
                                        </div>
                                    </div>
                                    {% endfor %}
                                    {#
                                    <div class="list-group-collapse sub-men">
                                        <a class="list-group-item list-group-item-action" href="#sub-men2" data-toggle="collapse" aria-expanded="false" aria-controls="sub-men2">
                                            Mobilier medical
                                            <small class="text-muted">(10)</small>
                                        </a>
                                        <div class="collapse" id="sub-men2" data-parent="#list-group-men">
                                            <div class="list-group">
                                                <a href="#" class="list-group-item list-group-item-action">Brancards <small class="text-muted">(4)</small></a>
                                                <a href="#" class="list-group-item list-group-item-action">Lit electriques <small class="text-muted">(3)</small></a>
                                                <a href="#" class="list-group-item list-group-item-action">Tables <small class="text-muted">(3)</small></a>
                                            </div>
                                        </div>
                                    </div>


                                        <a href="#" class="list-group-item list-group-item-action"> Famille 1 <small class="text-muted">(150) </small></a>
                                        <a href="#" class="list-group-item list-group-item-action"> Famille 2 <small class="text-muted">(11)</small></a>
                                        <a href="#" class="list-group-item list-group-item-action"> Famille 3 <small class="text-muted">(22)</small></a>
                                    #}
                                    {#                                </div> #}
                                </div>
                                <div class="filter-price-left">
                                    {# <div class="title-left">
                                        <h3>Prix</h3>
                                    </div>
                                    <div class="price-box-slider">
                                        <div id="slider-range"></div>
                                        <p>
                                            <input type="text" id="amount" readonly style="border:0; color:#fbb714; font-weight:bold;">
                                            <button class="btn hvr-hover" type="submit">Filtre</button>
                                        </p>
                                    </div> #}
                                </div>
                            </div>
                        </div>
                    </div>
                    {#                </div> #}
                    <div class="col-xl-9 col-lg-9 col-sm-12 col-xs-12 shop-content-right">
                        <div class="right-product-box">
                            <div class="product-item-filter row">
                                <div class="col-12 col-sm-8 text-center text-sm-left">
                                    <div class="toolbar-sorter-right">
                                        {#                                        <span>Trier par </span> #}
                                        <div class="search-product">
                                            <form action="#">
                                                <input class="form-control" placeholder="Recherche..." type="text"
                                                       disabled>
                                                <button type="submit"><i class="fa fa-search"></i></button>
                                            </form>
                                        </div>
                                        {#                                        <select id="basic" class="selectpicker show-tick form-control" data-placeholder="DH"> #}
                                        {#                                            <option data-display="Select">Aucun</option> #}
                                        {#                                            <option value="1">Popularité</option> #}
                                        {#                                            <option value="2">Prix décroissant</option> #}
                                        {#                                            <option value="3">Prix croissant</option> #}
                                        {#                                                                                    <option value="3">Low Price â†’ High Price</option> #}
                                        {#                                            <option value="4">Meilleurs ventes</option> #}
                                        {#                                        </select> #}
                                    </div>
                                    <p>Afficher <span class="result-prod">{{ articles|length }}</span></p>
                                </div>
                                <div class="col-12 col-sm-4 text-center text-sm-right">
                                    <ul class="nav nav-tabs ml-auto">
                                        <li>
                                            <a class="nav-link active" href="#grid-view" data-toggle="tab"> <i
                                                        class="fa fa-th"></i> </a>
                                        </li>
                                        <li>
                                            <a class="nav-link" href="#list-view" data-toggle="tab"> <i
                                                        class="fa fa-list-ul"></i> </a>
                                        </li>
                                    </ul>
                                </div>
                            </div>

                            <div class="product-categorie-box">

                                {# Présentation cards #}
                                <div class="tab-content">
                                    <div role="tabpanel" class="tab-pane fade show active" id="grid-view">
                                        <div class="row">
                                            {% for article in articles %}
                                                <!-- Card d'article - Grid - Start -->
                                                <div class="col-sm-6 col-md-6 col-lg-4 col-xl-4">
                                                    <div class="products-single fix">
                                                        {# <div class="box-img-hover">
                                                            <div class="type-lb">
                                                                <p class="sale">Vente</p>
                                                            </div>
                                                            <img src="{{ asset('uploads/images/articles/' ~ article.coverImage) }}" class="img-fluid" alt="Image">
                                                            <div class="mask-icon">
                                                                <ul>
                                                                    <li><a href="{{ path('article_detail', {id: article.id}) }}" data-toggle="tooltip" data-placement="right" title="Voir"><i class="fas fa-eye"></i></a></li>
                                                                    <li><a href="#" data-toggle="tooltip" data-placement="right" title="Comparer"><i class="fas fa-sync-alt"></i></a></li>
                                                                    <li><a href="#" data-toggle="tooltip" data-placement="right" title="Ajouter Ã  ma liste"><i class="far fa-heart"></i></a></li>
                                                                </ul>
                                                                <a  id="add_to_cart" class="cart" data-path="{{ path('cart_add',{'id':article.id}) }}">Ajouter au panier ....</a>
                                                            </div>
                                                        </div> #}
                                                        {# <div class="why-text"> #}
                                                        {# <h4>{{ article.designation}}</h4> #}
                                                        {# {% if app.user %} #}
                                                        {# <h5>{{ article.price |number_format(2, ',', ' ')}} DH</h5> #}
                                                        {# {% endif %} #}
                                                        {# </div> #}

                                                        <div class="product-grid">
                                                            <div class="product-image">
                                                                <a href="#" class="image">
                                                                    {% if article.coverImage %}
                                                                        <img class="pic-1"
                                                                             src="{{ asset('uploads/images/articles/' ~ article.coverImage) }}" alt="Image de l'article">

                                                                    {% else %}
                                                                        <img class="pic-1"
                                                                             src="{{ asset('uploads/images/articles/NON-DISPO.png') }}" alt="Pas d'image de l'article">
{#                                                                             src="https://via.placeholder.com/400x470">#}
                                                                    {% endif %}
                                                                </a>
                                                                <ul class="product-links">
                                                                    <li>
                                                                        {#                                                                        <a id="add_to_cart" class="cart" data-path="{{ path('cart_add',{'id':article.id}) }}"> #}
                                                                        {#                                                                            <i class="fa fa-shopping-bag"></i> Ajouter au panier</a> #}
                                                                    </li>
                                                                    <li>
                                                                        <a href="{{ path('article_detail', {id: article.id}) }}"><i
                                                                                    class="fa fa-search"></i> Plus de
                                                                            détails</a></li>
                                                                </ul>
                                                            </div>
                                                            <div class="product-content">

                                                                <h3 class="title"><a
                                                                            href="{{ path('article_detail', {id: article.id}) }}">{{ article.designation }}</a>
                                                                </h3>
                                                                <div class="row">
                                                                    <div class="col-sm-6">
                                                                        <div class="row price">
                                                                            {# {{ article.price |number_format(2, ',', ' ')}} DH #}
                                                                        </div>
                                                                        <div class="row mx-auto">
                                                                            <b class="col-green">{{ article.reference }}</b>
                                                                        </div>
                                                                    </div>
                                                                    <div class="col-sm-6">
                                                                        {% set firstVariant = article.variants|first %}
                                                                        {% if firstVariant %}
                                                                            {% if firstVariant.brand %}
                                                                                <img class="w-100 my-auto"
                                                                                     src="{{ asset('uploads/images/brands/' ~ firstVariant.brand.logo) }}"/>
                                                                            {% else %}
                                                                                <img class="w-100 my-auto"
                                                                                     src="https://via.placeholder.com/265x113"/>
                                                                            {% endif %}
                                                                        {% endif %}
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <!-- Card d'article - Grid - End -->

                                            {% endfor %}
                                        </div>
                                    </div>

                                    {# Présentation Tabulaire #}
                                    <div role="tabpanel" class="tab-pane fade" id="list-view">
                                        {% for article in articles %}
                                            <!-- Card d'article - List - Start -->

                                            <div class="list-view-box">
                                                <div class="row">
                                                    <div class="col-sm-6 col-md-6 col-lg-4 col-xl-4">
                                                        <div class="products-single fix">
                                                            <div class="box-img-hover">
                                                                <img src="{{ asset('uploads/images/articles/' ~ article.coverImage) }}"
                                                                     class="img-fluid" alt="Image">
                                                                <div class="type-lb">
                                                                    <p class="new">Nouveau</p>
                                                                </div>
                                                                <div class="mask-icon">
                                                                    <ul>
                                                                        <li>
                                                                            <a href="{{ path('article_detail', {id: article.id}) }}"
                                                                               data-toggle="tooltip"
                                                                               data-placement="right" title="Voir"><i
                                                                                        class="fas fa-eye"></i></a></li>
                                                                        <li><a href="#" data-toggle="tooltip"
                                                                               data-placement="right"
                                                                               title="Comparer"><i
                                                                                        class="fas fa-sync-alt"></i></a>
                                                                        </li>
                                                                        <li><a href="#" data-toggle="tooltip"
                                                                               data-placement="right"
                                                                               title="Ajouter Ã  ma liste"><i
                                                                                        class="far fa-heart"></i></a>
                                                                        </li>
                                                                    </ul>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="col-sm-6 col-md-6 col-lg-8 col-xl-8">
                                                        <div class="why-text full-width">
                                                            <h4>{{ article.designation }}</h4>
                                                            {# {% if app.user %} #}
                                                            {# <h5> <del>{{ (article.price * 1.2) |number_format(2, ',', ' ')}} </del> {{ article.price  |number_format(2, ',', ' ') }} DH</h5> #}
                                                            {# {% endif %} #}

                                                            <p>{{ article.description|raw }}</p>
                                                            {# <p>Integer tincidunt aliquet nibh vitae dictum. In turpis sapien, imperdiet quis magna nec, iaculis ultrices ante. Integer vitae suscipit nisi. Morbi dignissim risus sit amet orci porta, eget aliquam purus
                                                                sollicitudin. Cras eu metus felis. Sed arcu arcu, sagittis in blandit eu, imperdiet sit amet eros. Donec accumsan nisi purus, quis euismod ex volutpat in. Vestibulum eleifend eros ac lobortis aliquet.
                                                                Suspendisse at ipsum vel lacus vehicula blandit et sollicitudin quam. Praesent vulputate semper libero pulvinar consequat. Etiam ut placerat lectus.</p> #}
                                                            {#                                                            <a id="add_to_cart" class="btn hvr-hover"  data-path="{{ path('cart_add',{'id':article.id}) }}">Ajouter au panier</a> #}
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <!-- Card d'article - List - End -->

                                        {% endfor %}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- End Shop Page -->
        </div>
    </div>
{% endblock %}

{% block javascripts %}
    <!-- Jquery -->
    <script src="{{ asset('js/vendor/jquery-3.7.1.min.js') }}"></script>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const collapseLinks = document.querySelectorAll('.list-group-collapse .collapse-btn');

            collapseLinks.forEach(link => {
                link.addEventListener('click', function (event) {
                    event.preventDefault(); // Pour empêcher le comportement de lien par défaut

                    const collapseContent = document.querySelector(this.getAttribute('href'));
                    const parentCollapse = collapseContent.closest('.list-group-collapse');

                    if (!parentCollapse.classList.contains('show')) {
                        const allCollapses = document.querySelectorAll('.list-group-collapse');
                        allCollapses.forEach(collapse => collapse.classList.remove('show'));
                    }

                    const listItems = parentCollapse.querySelectorAll('.list-group-item[data-toggle="collapse"]');
                    listItems.forEach(item => {
                        if (!parentCollapse.classList.contains('show')) {
                            item.classList.add('collapsed');
                        } else {
                            item.classList.remove('collapsed');
                        }
                    });
                });
            });
        });

    </script>
    <script>
        function onAddArticle(event) {
            event.preventDefault();
            console.log("#add_to_cart is clicked");
            var $url = $(this).attr("data-path");
            console.log($url);
            $.ajax({
                type: "POST",
                url: $url,
                success: function (data) {
                    CartPreview(data);
                }
            });

        }

        $(document).ready(function () {
            console.log("Shop.html.twig.is Ready");

            document.querySelectorAll('#add_to_cart').forEach(function (link) {
                link.addEventListener('click', onAddArticle);
            });

        });
    </script>
{% endblock %}
